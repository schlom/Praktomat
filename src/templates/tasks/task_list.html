{% extends "base.html" %}
{% load i18n %} {% load chunks %}
{% block extrahead %}{{ block.super }}
<script type="text/javascript">	
	window.onload = function() {
		var all_grades = new Array();
		var grades=new Array();
		$('.grade_cell').each(function(index) {
			grades[index] = $(this).text()
		});
		
		{% include "attestation/rating_scale_items_js_inline.html" with tasks=expired_tasks %}
		
		var result;
		try {
			{{script|safe}}
		} catch (e) {
		}

		if (result) {
			$("#calculated_grade_cell").text(result);
		} else {
			$("#predicted_final_grade").hide();
		}
		
	};	
	</script>
{% endblock %} 
{% block breadcrumbs %}<span class="icon icon-white ui-icon-home"></span>Home{% endblock %}
{% block content %}<div id='task_list'>

<div id="welcome">

	{% chunk "Welcome Message" %}
	
	{% if show_contact_link and not user.is_trainer and not user.is_superuser %}
		{% if tutors or trainers %}
			<div id="contact"><a> Got Problems? </a>
			{% if tutors %}
				<a> Your tutor{{tutors.count|pluralize}}: </a>
				{% for tutor in tutors %}
					<a href="mailto:{{tutor.email}}">{{tutor.get_full_name}}</a>	
				{% endfor %}
			{% endif %}
			{% if trainers %}
				<a> Your trainer{{trainers.count|pluralize}}: </a>
				{% for trainer in trainers %}
					<a href="mailto:{{trainer.email}}">{{trainer.get_full_name}}</a>	
				{% endfor %}
			{% endif %}</div>
		{% endif %}
	{% endif %}
</div>


{% regroup tasks by 0.expired as grouped_tasks %}

<div>{% for group in grouped_tasks %}
    <div id="{% if group.grouper %}expired_tasks{% else %}upcoming_tasks{% endif %}" class="{% if group.grouper %}right{% else %}left{% endif %}" >
		<h2>{% if group.grouper %}{% trans "Expired tasks" %}{% else %}{% trans "Upcoming tasks" %}{% endif %}</h2>
		{% for task, final_solution in group.list%}
			<h3><a href="{% url "task_detail" task_id=task.id%}">{{task.title}}</a></h3>
			Due: {{ task.submission_date|date }} {{ task.submission_date|time }}
			{% if user.is_user %}
				<a href="{% url "solution_list" task_id=task.id%}">{% trans "Solutions"%}</a>
				{% if final_solution %}
				  <br/>
				  Final solution submitted {{ final_solution.creation_date|timesince}} ago.
				{% endif %}
			{% endif %}
			{% if user.is_tutor or user.is_trainer%}
				<a href="{% url "attestation_list" task_id=task.id%}">{% trans "Attestation"%}</a>
				<a href="{% url "statistics" task_id=task.id%}">{% trans "Statistics"%}</a>
				{% if HAS_JPLAG %}
				<a href="{% url "solution_jplag" task_id=task.id%}">{% trans "jPlag"%}</a>
				{% endif %}
			{% endif %} <br/><br/>
		{% endfor %}
	</div>
{% empty %}
	<a>{% trans "No tasks to be submitted at the moment." %}</a>
{% endfor %}</div>

{% if user.is_user %}	
	{% if attestations %}
		<div id="attestation_overview">
			<h2>Result Overview</h2>
			<table>
				<tr><th>Task</th><th>Grade</th><th>Rating Scale</th></tr>
				{% for task, attestation in attestations%}
					<tr>
						<td>{{task}}</td>
						<td class="grade_cell">{% if attestation %}
							<a href="{% url "view_attestation" attestation_id=attestation.id%}">{{attestation.final_grade}} </a>
							{%else%}-{%endif%}</td>
						<td>{{task.final_grade_rating_scale.name}}</td>
					</tr>
				{% endfor %}
				
				{% if show_final_grade %}
					<tr class="final_grade"><td>Final Grade</td><td>{{user.final_grade}}</td></tr>
				{% else %}
					<tr class="final_grade" id="predicted_final_grade"><td>Predicted Final Grade</td><td id="calculated_grade_cell"></td></tr>
				{% endif %}
				
			</table>
		</div>
	{% endif %}
{% endif %}


</div>{% endblock %}
